name: Edit and Push to GH-Pages

on:
  workflow_dispatch:  # Allows manual trigger
  push:
    branches:
      - main  # Or your default branch

jobs:
  edit-and-push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for all branches and tags.

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '14'  # Choose a Node.js version

      - name: Install dependencies
        run: npm install simple-git

      - name: Edit and push to gh-pages
        run: |
          node <<EOF
          const fs = require('fs');
          const simpleGit = require('simple-git');
          
          async function main() {
            try {
              const git = simpleGit();
              
              // Ensure gitignore has node_modules and package-lock.json
              if (fs.existsSync('.gitignore')) {
                let ignoreContent = fs.readFileSync('.gitignore', 'utf8');
                if (!ignoreContent.includes('node_modules/')) {
                  fs.appendFileSync('.gitignore', '\nnode_modules/\npackage-lock.json');
                }
              } else {
                fs.writeFileSync('.gitignore', 'node_modules/\npackage-lock.json');
              }
              await git.add('.gitignore');
              await git.commit('Add node_modules to .gitignore');
          
              // Stash changes
              await git.stash();
          
              // Switch to gh-pages branch
              await git.checkout('gh-pages');
              console.log('Switched to gh-pages branch');
          
              // ... rest of your script for editing and pushing
          
            } catch (error) {
              console.error('An error occurred:', error.message);
            }
          }
          
          main();
          EOF
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
